services:
  basekit:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    image: agroecology/open_agbot:latest
    container_name: open_agbot_basekit
    privileged: true
    network_mode: host
    restart: unless-stopped
    
    # Allows the container to access serial ports
    group_add:
      - dialout

    # Mapping ports with environment overrides
    # For ThinkPad, we set these in simple.py or a .env file
    devices:
      - "${CONTROLLER_PORT:-/dev/ttyTHS0}:/dev/ttyTHS0"
      - "${GPS_PORT:-/dev/ttyS31}:/dev/ttyACM1"

    volumes:
      - /dev:/dev
      # Mount the local config so changes on the host reflect in the container
      - ./src:/workspace/src

    environment:
      - RMW_IMPLEMENTATION=rmw_cyclonedds_cpp
      - PYTHONUNBUFFERED=1
      # Default to laptop mode if not specified
      - HW_PLATFORM=${HW_PLATFORM:-laptop}
